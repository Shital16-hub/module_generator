[
  {
    "doc_id": "CONF-SRCH-006",
    "space": "Engineering",
    "title": "Search Implementation - Elasticsearch Guide",
    "page_url": "https://confluence.company.com/display/ENG/Search+Implementation",
    "parent_page": "Technical Guides",
    "created_by": "Search Engineer",
    "created_date": "2024-08-05",
    "last_updated": "2024-11-18",
    "last_updated_by": "Backend Developer",
    "module": "Search",
    "type": "technical_guide",
    "labels": [
      "search",
      "elasticsearch",
      "implementation",
      "performance"
    ],
    "content": "# Search Implementation - Elasticsearch Guide\n\n## Architecture Overview\n\n### Elasticsearch Cluster\n- 3-node cluster for high availability\n- 1 master node, 2 data nodes\n- Automatic failover configured\n- Daily snapshots to S3\n\n### Index Structure\n**products_v1:**\n- Primary product search index\n- Updated in real-time via message queue\n- 10 shards, 1 replica\n\n**Mapping:**\n{\n  \"mappings\": {\n    \"properties\": {\n      \"id\": {\"type\": \"keyword\"},\n      \"name\": {\"type\": \"text\", \"analyzer\": \"standard\"},\n      \"description\": {\"type\": \"text\", \"analyzer\": \"english\"},\n      \"category\": {\"type\": \"keyword\"},\n      \"price\": {\"type\": \"float\"},\n      \"stock\": {\"type\": \"integer\"},\n      \"rating\": {\"type\": \"float\"},\n      \"tags\": {\"type\": \"keyword\"}\n    }\n  }\n}\n\n## Search Features\n\n### Full-Text Search\nBasic text search with relevance scoring:\n```\nGET /products_v1/_search\n{\n  \"query\": {\n    \"multi_match\": {\n      \"query\": \"wireless headphones\",\n      \"fields\": [\"name^3\", \"description\", \"tags\"],\n      \"type\": \"best_fields\"\n    }\n  }\n}\n```\n\n### Fuzzy Matching\nHandle typos and misspellings:\n```\n{\n  \"query\": {\n    \"match\": {\n      \"name\": {\n        \"query\": \"wireles hedphones\",\n        \"fuzziness\": \"AUTO\"\n      }\n    }\n  }\n}\n```\n\n### Filtering\nCombine search with filters:\n```\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": {\"match\": {\"name\": \"headphones\"}},\n      \"filter\": [\n        {\"range\": {\"price\": {\"gte\": 50, \"lte\": 200}}},\n        {\"term\": {\"category\": \"Electronics\"}},\n        {\"range\": {\"stock\": {\"gt\": 0}}}\n      ]\n    }\n  }\n}\n```\n\n### Aggregations\nFaceted search for category counts:\n```\n{\n  \"aggs\": {\n    \"categories\": {\n      \"terms\": {\"field\": \"category\"},\n      \"price_ranges\": {\n        \"range\": {\n          \"field\": \"price\",\n          \"ranges\": [\n            {\"to\": 50},\n            {\"from\": 50, \"to\": 100},\n            {\"from\": 100, \"to\": 200},\n            {\"from\": 200}\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\n### Auto-Complete\nSuggest queries as user types:\n```\n{\n  \"suggest\": {\n    \"product-suggest\": {\n      \"prefix\": \"wire\",\n      \"completion\": {\n        \"field\": \"name.suggest\",\n        \"size\": 5\n      }\n    }\n  }\n}\n```\n\n## Relevance Tuning\n\n### Field Boosting\nWeight different fields:\n- name: boost 3x\n- description: boost 1x\n- tags: boost 2x\n\n### Synonym Handling\nCommon synonyms configured:\n- \"phone\" \u2192 \"mobile\", \"smartphone\", \"cell phone\"\n- \"laptop\" \u2192 \"notebook\", \"computer\"\n- \"tv\" \u2192 \"television\"\n\n### Custom Analyzers\n**Product Analyzer:**\n- Lowercase filter\n- Stop words removal\n- Synonym filter\n- Stemming (English)\n\n## Performance Optimization\n\n### Index Settings\n- Refresh interval: 1s (real-time)\n- Number of shards: 10\n- Number of replicas: 1\n- Max result window: 10000\n\n### Query Performance\nTarget latency: <100ms for 95th percentile\n\n**Optimization Techniques:**\n- Use filter context for non-scoring queries\n- Limit result size\n- Use pagination with search_after\n- Enable query cache\n- Optimize mapping (disable _source if not needed)\n\n### Monitoring\nKey metrics tracked:\n- Query latency (p50, p95, p99)\n- Indexing rate\n- Cluster health\n- Disk usage\n- Cache hit rate\n\n## Data Synchronization\n\n### Real-Time Updates\n- Product changes published to message queue\n- Elasticsearch consumer updates index\n- Typical lag: <1 second\n\n### Bulk Reindexing\nFor schema changes or major updates:\n1. Create new index with updated mapping\n2. Reindex data using scroll API\n3. Test new index\n4. Update alias to point to new index\n5. Delete old index\n\n## Search Analytics\n\n### Tracked Metrics\n- Search volume (queries per hour)\n- Top search terms\n- Zero-result searches\n- Click-through rate\n- Conversion rate by search term\n\n### Query Logs\nLogged for analysis:\n- Search query\n- Number of results\n- Response time\n- User clicked results\n- User ID (anonymized)\n\n## Troubleshooting\n\n### Slow Queries\n**Symptoms:** Response time >500ms\n**Solutions:**\n- Check query complexity\n- Review index mapping\n- Increase cluster resources\n- Optimize filters\n- Use profile API to identify bottlenecks\n\n### Zero Results\n**Symptoms:** Valid queries return no results\n**Solutions:**\n- Check analyzer configuration\n- Review synonym list\n- Verify data indexing\n- Test with simpler queries\n\n### Index Corruption\n**Symptoms:** Cluster health yellow/red\n**Solutions:**\n- Check shard allocation\n- Review disk space\n- Restore from snapshot if necessary\n- Reindex affected data\n\n## Best Practices\n\n1. **Use Appropriate Field Types**\n   - keyword for exact matching\n   - text for full-text search\n   - numeric types for range queries\n\n2. **Optimize Mapping**\n   - Disable _all field\n   - Set index: false for non-searchable fields\n   - Use doc_values appropriately\n\n3. **Query Optimization**\n   - Use filter context when possible\n   - Avoid wildcards at beginning\n   - Limit aggregation size\n   - Use constant_score for non-scoring queries\n\n4. **Monitoring and Alerting**\n   - Set up alerts for cluster health\n   - Monitor query latency\n   - Track index size growth\n   - Review slow query logs\n\n## Related Documentation\n- [Elasticsearch Official Docs](link)\n- [Query DSL Reference](link)\n- [Performance Tuning Guide](link)",
    "attachments": [
      "elasticsearch_architecture.png",
      "query_examples.json"
    ],
    "linked_jira_issues": [
      "SRCH-007",
      "SRCH-005"
    ],
    "linked_test_cases": [
      "TC-SRCH-020",
      "TC-SRCH-021",
      "TC-SRCH-022"
    ]
  }
]