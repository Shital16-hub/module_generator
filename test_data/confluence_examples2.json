[
  {
    "doc_id": "CONF-AUTH-002",
    "space": "Engineering",
    "title": "Authentication & Authorization - Implementation Guide",
    "page_url": "https://confluence.company.com/display/ENG/Auth+Implementation",
    "parent_page": "Security Architecture",
    "created_by": "Security Architect",
    "created_date": "2024-10-01",
    "last_updated": "2024-11-20",
    "last_updated_by": "Senior Developer",
    "module": "Authentication",
    "type": "implementation_guide",
    "labels": [
      "security",
      "authentication",
      "oauth",
      "jwt"
    ],
    "content": "# Authentication & Authorization - Implementation Guide\n\n## Overview\nThis document describes the authentication and authorization mechanisms used across the platform, including user login, session management, and access control.\n\n## Authentication Methods\n\n### 1. Email/Password Authentication\n**Flow:**\n1. User submits email and password\n2. System hashes password using bcrypt (cost factor: 12)\n3. Comparison with stored hash\n4. If valid, generate JWT token\n5. Return token to client\n\n**Password Requirements:**\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one number\n- At least one special character\n- Cannot be common password (checked against breach database)\n\n### 2. Multi-Factor Authentication (MFA)\n**Supported Methods:**\n- **TOTP (Time-based One-Time Password)**: Using Google Authenticator, Authy\n- **SMS**: Via Twilio integration\n- **Email**: Backup method\n\n**MFA Setup Flow:**\n1. User enables MFA in settings\n2. System generates secret key\n3. QR code displayed for authenticator app\n4. User enters first code to verify setup\n5. Backup codes generated (10 codes)\n\n**MFA Login Flow:**\n1. User enters email/password\n2. System validates credentials\n3. If valid and MFA enabled, prompt for code\n4. User enters 6-digit TOTP code\n5. System validates code (accepts current + \u00b11 time window)\n6. Generate session token\n\n### 3. Social Login (OAuth 2.0)\n**Providers:**\n- Google\n- Facebook\n- Apple\n\n**OAuth Flow:**\n1. User clicks \"Sign in with Google\"\n2. Redirect to provider authorization page\n3. User grants permissions\n4. Provider redirects back with authorization code\n5. System exchanges code for access token\n6. Retrieve user profile information\n7. Create or update user account\n8. Generate session token\n\n## Authorization\n\n### Role-Based Access Control (RBAC)\n**Roles:**\n- **Customer**: Basic shopping permissions\n- **Premium Customer**: Enhanced features (early access, special deals)\n- **Customer Service**: View orders, process refunds, contact customers\n- **Warehouse Staff**: Manage inventory, process shipments\n- **Manager**: Full access to reports and analytics\n- **Admin**: System configuration and user management\n\n**Permission Matrix:**\n| Action | Customer | Premium | CS Rep | Warehouse | Manager | Admin |\n|--------|----------|---------|--------|-----------|---------|-------|\n| Place Order | \u2713 | \u2713 | \u2713 | \u2717 | \u2713 | \u2713 |\n| View Reports | \u2717 | \u2717 | Limited | Limited | \u2713 | \u2713 |\n| Process Refund | \u2717 | \u2717 | \u2713 | \u2717 | \u2713 | \u2713 |\n| Manage Inventory | \u2717 | \u2717 | \u2717 | \u2713 | \u2713 | \u2713 |\n| User Management | \u2717 | \u2717 | \u2717 | \u2717 | \u2717 | \u2713 |\n\n## Session Management\n\n### JWT Token Structure\n{\n  \"sub\": \"user_id_12345\",\n  \"email\": \"user@example.com\",\n  \"role\": \"customer\",\n  \"iat\": 1700000000,\n  \"exp\": 1700003600\n}\n\n**Token Expiry:**\n- Access Token: 1 hour\n- Refresh Token: 30 days\n- Remember Me: 90 days\n\n### Token Refresh Flow\n1. Access token expires\n2. Client sends refresh token to /auth/refresh\n3. System validates refresh token\n4. Generate new access token\n5. Return new token pair\n\n## Security Best Practices\n\n### Password Storage\n- Use bcrypt with cost factor 12\n- Salt is automatically generated\n- Never store plaintext passwords\n- Implement password history (prevent reuse of last 5)\n\n### Session Security\n- HTTP-only cookies for tokens (prevent XSS)\n- Secure flag enabled (HTTPS only)\n- SameSite attribute set to 'strict'\n- CSRF tokens for state-changing operations\n\n### Account Lockout\n- Lock account after 5 failed attempts\n- Lockout duration: 30 minutes\n- Email notification sent to user\n- Admin can unlock accounts\n\n### Security Headers\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nX-XSS-Protection: 1; mode=block\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nContent-Security-Policy: default-src 'self'\n\n## API Endpoints\n\n### Login\n**POST** /api/v1/auth/login\nRequest:\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePass123!\"\n}\n\nResponse:\n{\n  \"access_token\": \"eyJhbGci...\",\n  \"refresh_token\": \"eyJhbGci...\",\n  \"user\": {\n    \"id\": \"12345\",\n    \"email\": \"user@example.com\",\n    \"role\": \"customer\"\n  }\n}\n\n### Enable MFA\n**POST** /api/v1/auth/mfa/enable\nHeaders: Authorization: Bearer {access_token}\n\nResponse:\n{\n  \"secret\": \"JBSWY3DPEHPK3PXP\",\n  \"qr_code\": \"data:image/png;base64,iVBOR...\",\n  \"backup_codes\": [\"12345678\", \"87654321\", ...]\n}\n\n## Testing Considerations\n- Test with various invalid password formats\n- Test account lockout mechanism\n- Test MFA with time drift scenarios\n- Test token expiry and refresh\n- Test OAuth flow with different providers\n- Test CSRF protection\n- Performance test: System should handle 1000 concurrent logins\n\n## Related Documentation\n- [OAuth 2.0 Integration](link)\n- [Security Audit Report](link)\n- [Penetration Testing Results](link)",
    "attachments": [
      "auth_flow_diagram.png",
      "jwt_token_example.json",
      "rbac_permission_matrix.xlsx"
    ],
    "linked_jira_issues": [
      "AUTH-015",
      "AUTH-014",
      "AUTH-016"
    ],
    "linked_test_cases": [
      "TC-AUTH-020",
      "TC-AUTH-021"
    ]
  }
]